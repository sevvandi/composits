<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to composits • composits</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to composits">
<meta property="og:description" content="composits">
<meta property="og:image" content="https://sevvandi.github.io/composits/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">composits</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/composits.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="composits_files/kePrint-0.0.1/kePrint.js"></script><link href="composits_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to composits</h1>
            
      
      
      <div class="hidden name"><code>composits.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">composits</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org" class="external-link">rgdal</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; Please note that rgdal will be retired by the end of 2023,</span>
<span class="co">#&gt; plan transition to sf/stars/terra functions using GDAL and PROJ</span>
<span class="co">#&gt; at your earliest convenience.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; rgdal: version: 1.5-31, (SVN revision 1171)</span>
<span class="co">#&gt; Geospatial Data Abstraction Library extensions to R successfully loaded</span>
<span class="co">#&gt; Loaded GDAL runtime: GDAL 3.4.1, released 2021/12/27</span>
<span class="co">#&gt; Path to GDAL shared files: C:/Users/sevva/OneDrive/Documents/R/win-library/4.1/rgdal/gdal</span>
<span class="co">#&gt; GDAL binary built with GEOS: TRUE </span>
<span class="co">#&gt; Loaded PROJ runtime: Rel. 7.2.1, January 1st, 2021, [PJ_VERSION: 721]</span>
<span class="co">#&gt; Path to PROJ shared files: C:/Users/sevva/OneDrive/Documents/R/win-library/4.1/rgdal/proj</span>
<span class="co">#&gt; PROJ CDN enabled: FALSE</span>
<span class="co">#&gt; Linking to sp version:1.4-7</span>
<span class="co">#&gt; To mute warnings of possible GDAL/OSR exportToProj4() degradation,</span>
<span class="co">#&gt; use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</span></code></pre></div>
<p>The goal of <em>composits</em> is to find outliers in compositional,
multivariate and univariate time series. It is an outlier ensemble
method that uses the outlier detection methods from R packages
<code>forecast</code>, <code>tsoutliers</code>, <code>anomalize</code>
and <code>otsad</code>. All the options provided in those packages can
be included in the calls for each of the methods used in the ensemble
function so that the user can create a more customize ensemble.</p>
<p>As describe in the paper four dimension reduction methods are used in
the multivariate ensemble PCA, DOBIN, ICS and ICA. It is recomended that
users verified the scaling and centering options of these methods for
each particular example.</p>
<div class="section level3">
<h3 id="univariate-time-series-outliers">Univariate time series outliers<a class="anchor" aria-label="anchor" href="#univariate-time-series-outliers"></a>
</h3>
<p>This example uses a univariate time series containing the daily gold
prices from the R package <code>forecast</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gold2</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/na.interp.html" class="external-link">na.interp</a></span><span class="op">(</span><span class="va">gold</span><span class="op">)</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uv_tsout_ens.html">uv_tsout_ens</a></span><span class="op">(</span><span class="va">gold2</span><span class="op">)</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">outliers</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">ts_gold</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">gold2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">gold2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_gold</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">inds</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">0.5</span>, linetype <span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Gold prices"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Don't know how to automatically pick scale for object of type ts. Defaulting to continuous.</span></code></pre></div>
<p><img src="composits_files/figure-html/univaraite1-1.png" width="768"></p>
<p>The red dashed vertical lines show the time points that have been
picked by 3 or more outlier detection methods.</p>
<p>Next we look at the quarterly production of woollen yarn in
Australia. This time series is also taken from the R package
<code>forecast</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uv_tsout_ens.html">uv_tsout_ens</a></span><span class="op">(</span><span class="va">woolyrnq</span><span class="op">)</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 59.5 days</span>
<span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">outliers</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">ts_wool</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">woolyrnq</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">woolyrnq</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_wool</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">inds</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">0.5</span>, linetype <span class="op">=</span><span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Woollen Yarn Production"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Don't know how to automatically pick scale for object of type ts. Defaulting to continuous.</span></code></pre></div>
<p><img src="composits_files/figure-html/univariate2-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="multivariate-time-series-outliers">Multivariate time series outliers<a class="anchor" aria-label="anchor" href="#multivariate-time-series-outliers"></a>
</h3>
<p>This example includes EU stock market data from the package
<em>datasets</em>. It contains the daily closing prices of 4 European
stock indices: Germany DAX, Switzerland SMI, France CAC, and UK FTSE.
First we plot the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stpart</span> <span class="op">&lt;-</span> <span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">600</span>, <span class="op">]</span>
<span class="va">stpart</span> <span class="op">&lt;-</span> <span class="va">EuStockMarkets</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">600</span>, <span class="op">]</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">stpart</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>   <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="composits_files/figure-html/multivariate1-1.png" width="768"></p>
<p>Then we find multivariate outliers. To find the multivariate
outliers, first we decompose the time series to univariate outliers by
using Principle Component Analysis (PCA), Independent Component Analysis
(ICA), DOBIN (Distance based Outlier BasIs using Neighbours) and ICS
(Invariant Coordinate Selection) decomposition methods. The
<code>fast=TRUE</code> option leaves out ICS decomposition. Then for a
selected number of components (default being 2) we find outliers using
the univariate time series ensemble. The outliers are given in the table
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mv_tsout_ens.html">mv_tsout_ens</a></span><span class="op">(</span><span class="va">stpart</span>, fast<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 90.5 days</span>
<span class="va">out</span><span class="op">$</span><span class="va">outliers</span>
<span class="co">#&gt;    Indices Total_Score Num_Coords Num_Methods     DOBIN       PCA       ICA</span>
<span class="co">#&gt; 11      36      1.6928          3           3 0.5460645 0.6552774 0.4914581</span>
<span class="co">#&gt; 18     127      0.3120          1           1 0.3120000 0.0000000 0.0000000</span>
<span class="co">#&gt; 20     205      0.8160          3           2 0.2733508 0.4059739 0.1366754</span>
<span class="co">#&gt; 32     316      1.4400          3           2 0.4710592 0.6156465 0.3532944</span>
<span class="co">#&gt; 34     319      0.6880          2           2 0.1720000 0.0000000 0.5160000</span>
<span class="co">#&gt; 41     331      1.5008          3           3 0.2728727 0.4093091 0.8186182</span>
<span class="co">#&gt; 42     366      0.3120          1           1 0.0000000 0.3120000 0.0000000</span>
<span class="co">#&gt; 48     546      0.3120          1           1 0.3120000 0.0000000 0.0000000</span>
<span class="co">#&gt;    forecast tsoutliers otsad anomalize Gap_Score_2</span>
<span class="co">#&gt; 11        0      1.248 0.320    0.1248          72</span>
<span class="co">#&gt; 18        0      0.312 0.000    0.0000           5</span>
<span class="co">#&gt; 20        0      0.624 0.192    0.0000          30</span>
<span class="co">#&gt; 32        0      1.248 0.192    0.0000          60</span>
<span class="co">#&gt; 34        0      0.624 0.064    0.0000          23</span>
<span class="co">#&gt; 41        0      1.248 0.128    0.1248          63</span>
<span class="co">#&gt; 42        0      0.312 0.000    0.0000           5</span>
<span class="co">#&gt; 48        0      0.312 0.000    0.0000           5</span>
<span class="fu"><a href="../reference/draw_table_html.html">draw_table_html</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:1150px; ">
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Indices
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
DOBIN
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
PCA
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
ICA
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Num_Coords
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
forecast
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
tsoutliers
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
otsad
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
anomalize
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Num_Methods
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Gap_Score_2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Total_Score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.55</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.66</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">1.25</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.32</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.12</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: pink !important;">1.69</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
41
</td>
<td style="text-align:right;">
331
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.27</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.41</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.82</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">1.25</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.13</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.12</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.5</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
32
</td>
<td style="text-align:right;">
316
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.47</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.35</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">1.25</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.19</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.44</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
20
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.27</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.41</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.14</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.19</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0.82</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
34
</td>
<td style="text-align:right;">
319
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.17</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.52</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.06</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0.69</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
18
</td>
<td style="text-align:right;">
127
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0.31</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
42
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0.31</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
48
</td>
<td style="text-align:right;">
546
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0.31</span>
</td>
</tr>
</tbody>
</table>
</div>
<p>The decomposed time series is shown in the figure below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_decomposed_all.html">plot_decomposed_all</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">out</span>, X <span class="op">=</span> <span class="va">stpart</span><span class="op">)</span></code></pre></div>
<p><img src="composits_files/figure-html/mvout2-1.png" width="768"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/animate_ts_ensemble.html">animate_ts_ensemble</a></span><span class="op">(</span><span class="va">out</span>, X<span class="op">=</span> <span class="va">stpart</span>,  max_frames <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p><img src="mvani.gif" width="90%"></p>
<p>The decomposition above shows three decomposition methods. If you
want to plot only one method, you can use the
<code>plot_decomposed</code> function. The outlying time-points are
shown in the figure above and below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_decomposed.html">plot_decomposed</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">out</span>, X <span class="op">=</span> <span class="va">stpart</span>,  method <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span></code></pre></div>
<p><img src="composits_files/figure-html/mvout3-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="composite-time-series-outliers">Composite time series outliers<a class="anchor" aria-label="anchor" href="#composite-time-series-outliers"></a>
</h3>
<p>For this example we use daily mortality counts in Spain organised by
autonomous communities provided by the Spanish government. The dataset
records mortality counts from the 18th of April 2018 until the 31th of
July 2020. To make the data compositional we divide the autonomous
communities counts by the total count for each day.</p>
<p>Compositional data live on a simplex, because the sums add up to a
constant. Before analysing such data, it is important to make the data
unconstrained. We make the data unconstrained by using a coordinate
transformation called the <em>null space coordinate transformation</em>.
We use the multivariate outlier detection ensemble discussed above on
these unconstrained data. More details are available in our paper.</p>
<p>First let us load this data and plot it.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'spanish_morte'</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">spanish_morte</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">uniq_dates</span> <span class="op">&lt;-</span> <span class="va">spanish_morte</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">uniq_dates</span>, <span class="va">df</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">uniq_dates</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="composits_files/figure-html/composite1-1.png" width="768"></p>
<p>Next we find the outliers using compositional time series outlier
ensemble.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/comp_tsout_ens.html">comp_tsout_ens</a></span><span class="op">(</span><span class="va">df</span>, fast<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Warning in locate.outliers.oloop(y = y, fit = fit, types = types, cval = cval, :</span>
<span class="co">#&gt; stopped when 'maxit.oloop = 4' was reached</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="co">#&gt; Converting from tbl_df to tbl_time.</span>
<span class="co">#&gt; Auto-index message: index = date</span>
<span class="co">#&gt; frequency = 7 days</span>
<span class="co">#&gt; trend = 91 days</span>
<span class="va">out</span><span class="op">$</span><span class="va">outliers</span>
<span class="co">#&gt;    Indices Total_Score Num_Coords Num_Methods DOBIN       PCA       ICS</span>
<span class="co">#&gt; 9      608    1.333810          3           3     0 0.2659128 0.6785748</span>
<span class="co">#&gt; 14     614    1.245822          3           2     0 0.4823768 0.4103209</span>
<span class="co">#&gt; 17     617    2.527133          3           4     0 0.5900087 1.0411267</span>
<span class="co">#&gt; 18     618    2.058266          3           4     0 0.7032293 0.7282780</span>
<span class="co">#&gt; 19     619    2.011199          3           3     0 0.6871481 0.7116240</span>
<span class="co">#&gt; 20     620    2.320759          3           3     0 0.9789607 0.7211629</span>
<span class="co">#&gt; 21     621    1.718309          3           3     0 0.5712493 0.7288769</span>
<span class="co">#&gt; 22     622    1.905486          3           3     0 0.7245766 0.7503857</span>
<span class="co">#&gt; 23     623    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 24     624    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 25     625    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 26     626    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 27     627    1.180651          3           2     0 0.5472661 0.2327586</span>
<span class="co">#&gt; 28     628    1.180651          3           2     0 0.5472661 0.2327586</span>
<span class="co">#&gt; 30     630    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 31     631    1.490212          3           2     0 0.5770036 0.4908127</span>
<span class="co">#&gt; 38     638    1.105713          3           3     0 0.4284070 0.2488990</span>
<span class="co">#&gt;          ICA  forecast tsoutliers     otsad anomalize Gap_Score_2</span>
<span class="co">#&gt; 9  0.3893229 0.0000000  0.2751652 0.6842925 0.3743527           1</span>
<span class="co">#&gt; 14 0.3531239 0.0000000  0.0000000 0.6842925 0.5615291           0</span>
<span class="co">#&gt; 17 0.8959980 0.3095609  0.8254957 0.4561950 0.9358818           4</span>
<span class="co">#&gt; 18 0.6267591 0.6191218  0.2751652 0.2280975 0.9358818           2</span>
<span class="co">#&gt; 19 0.6124265 0.6191218  0.0000000 0.4561950 0.9358818           2</span>
<span class="co">#&gt; 20 0.6206358 0.9286827  0.0000000 0.4561950 0.9358818           3</span>
<span class="co">#&gt; 21 0.4181830 0.9286827  0.0000000 0.2280975 0.5615291           2</span>
<span class="co">#&gt; 22 0.4305234 0.9286827  0.0000000 0.2280975 0.7487054           2</span>
<span class="co">#&gt; 23 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 24 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 25 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 26 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 27 0.4006261 0.6191218  0.0000000 0.0000000 0.5615291           0</span>
<span class="co">#&gt; 28 0.4006261 0.6191218  0.0000000 0.0000000 0.5615291           0</span>
<span class="co">#&gt; 30 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 31 0.4223955 0.9286827  0.0000000 0.0000000 0.5615291           1</span>
<span class="co">#&gt; 38 0.4284070 0.0000000  0.2751652 0.4561950 0.3743527           0</span>
<span class="fu"><a href="../reference/draw_table_html.html">draw_table_html</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">uniq_dates</span><span class="op">)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:1000px; ">
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Indices
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
DOBIN
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
PCA
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
ICS
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
ICA
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Num_Coords
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
forecast
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
tsoutliers
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
otsad
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
anomalize
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Num_Methods
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Gap_Score_2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Total_Score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
17
</td>
<td style="text-align:left;">
2020-03-19
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.59</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">1.04</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.9</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.31</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.83</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.46</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.94</span>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: pink !important;">2.53</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
2020-03-22
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.98</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.72</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.62</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.46</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.94</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">2.32</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
2020-03-20
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.7</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.73</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.63</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.28</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.23</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.94</span>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">2.06</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
2020-03-21
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.69</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.71</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.61</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.46</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.94</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">2.01</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
2020-03-24
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.72</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.75</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.43</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.23</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.75</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.91</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
2020-03-23
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.57</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.73</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.23</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.72</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
2020-03-25
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
2020-03-26
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
2020-03-27
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
2020-03-28
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
2020-04-01
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
31
</td>
<td style="text-align:left;">
2020-04-02
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.49</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.42</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.93</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.49</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2020-03-10
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.27</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.68</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.39</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.28</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.68</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.37</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.33</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:left;">
2020-03-16
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.48</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.41</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.35</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.68</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.25</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
2020-03-29
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.55</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.23</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.4</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.18</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
28
</td>
<td style="text-align:left;">
2020-03-30
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.55</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.23</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.4</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.56</span>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.18</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
38
</td>
<td style="text-align:left;">
2020-04-09
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.43</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.25</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightgreen !important;">0.43</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.28</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.46</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: lightblue !important;">0.37</span>
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
<span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">1.11</span>
</td>
</tr>
</tbody>
</table>
</div>
<p>The table above shows the outlying dates and the associated scores.
The outlying dates correspond to the COVID-19 outbreak. We can see the
decomposed univariate time series in the following plot and the spike
around mid March in 2020.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_decomposed_all.html">plot_decomposed_all</a></span><span class="op">(</span>obj<span class="op">=</span><span class="va">out</span>, X <span class="op">=</span> <span class="va">df</span><span class="op">)</span></code></pre></div>
<p><img src="composits_files/figure-html/composite3-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># animate_ts_ensemble(out, X= df,  max_frames = 1)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/animate_ts_ensemble.html">animate_ts_ensemble</a></span><span class="op">(</span><span class="va">out</span>, X<span class="op">=</span> <span class="va">df</span>,  max_frames <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p><img src="compani.gif" width="90%"></p>
<p>Next we apportion the outlying scores back to the autonomous
communities. This is another coordinate transformation from the outlier
score space to the original coordinate space.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">apportioned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apportion_scores_comp.html">apportion_scores_comp</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span>
<span class="va">apportioned1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="va">apportioned</span><span class="op">$</span><span class="va">scores_out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">apportioned1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'reg'</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">apportioned1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">apportioned1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">uniq_dates</span><span class="op">[</span><span class="va">out</span><span class="op">$</span><span class="va">outliers</span><span class="op">$</span><span class="va">Indices</span><span class="op">]</span><span class="op">)</span>
<span class="va">apportioned1</span>
<span class="co">#&gt;    reg 2020-03-10 2020-03-16 2020-03-19 2020-03-20 2020-03-21 2020-03-22</span>
<span class="co">#&gt; 1   AN 0.32341919 0.36447401 0.51111105 0.50024464 0.48065052 0.60951952</span>
<span class="co">#&gt; 2   AR 0.05837388 0.03623257 0.08876023 0.06247578 0.06264642 0.06324072</span>
<span class="co">#&gt; 3   AS 0.04791881 0.04920321 0.06754037 0.06542602 0.06303890 0.07873879</span>
<span class="co">#&gt; 4   IB 0.03273911 0.03217926 0.04513337 0.04295407 0.04148540 0.05114475</span>
<span class="co">#&gt; 5   CN 0.14535574 0.12206323 0.21238119 0.18127923 0.17724929 0.20375385</span>
<span class="co">#&gt; 6   CB 0.26049471 0.15990410 0.37448049 0.27304510 0.27264200 0.27529316</span>
<span class="co">#&gt; 7   CL 0.19283902 0.13761142 0.27543365 0.21736488 0.21482200 0.23154635</span>
<span class="co">#&gt; 8   CM 0.22273675 0.18645676 0.29979859 0.26205876 0.25581530 0.29687807</span>
<span class="co">#&gt; 9   CT 0.44831030 0.47065388 0.80699066 0.72450618 0.70190214 0.85056719</span>
<span class="co">#&gt; 10  VC 0.16683435 0.15229735 0.21227672 0.19904436 0.19282849 0.23370980</span>
<span class="co">#&gt; 11  EX 0.09255332 0.06234621 0.13105340 0.10069903 0.09990410 0.10513234</span>
<span class="co">#&gt; 12  GA 0.20333424 0.17891524 0.28863758 0.25505579 0.24842112 0.29205680</span>
<span class="co">#&gt; 13  MD 0.30705221 0.29918634 0.34048480 0.32404859 0.30989185 0.40299966</span>
<span class="co">#&gt; 14  MC 0.14416185 0.10692186 0.20593075 0.16573274 0.16335987 0.17896606</span>
<span class="co">#&gt; 15  NC 0.03594668 0.02412428 0.05386088 0.04080028 0.04051785 0.04237537</span>
<span class="co">#&gt; 16  PV 0.11481962 0.08100022 0.16069751 0.12671393 0.12529143 0.13464713</span>
<span class="co">#&gt; 17  RI 0.07901541 0.04784458 0.11513294 0.08361720 0.08358360 0.08380462</span>
<span class="co">#&gt; 18  CE 0.09986394 0.06116205 0.14469823 0.10574842 0.10562073 0.10646054</span>
<span class="co">#&gt; 19  ML 0.05886714 0.03691720 0.08570435 0.06326674 0.06309290 0.06423623</span>
<span class="co">#&gt;    2020-03-23 2020-03-24 2020-03-25 2020-03-26 2020-03-27 2020-03-28 2020-03-29</span>
<span class="co">#&gt; 1  0.46653205 0.48362840 0.43597210 0.43597210 0.43597210 0.43597210 0.39449789</span>
<span class="co">#&gt; 2  0.06225671 0.06048725 0.04334024 0.04334024 0.04334024 0.04334024 0.01766789</span>
<span class="co">#&gt; 3  0.06565976 0.06600873 0.05885529 0.05885529 0.05885529 0.05885529 0.04962067</span>
<span class="co">#&gt; 4  0.04379739 0.04373269 0.03849180 0.03849180 0.03849180 0.03849180 0.03129136</span>
<span class="co">#&gt; 5  0.17860110 0.18041755 0.14600812 0.14600812 0.14600812 0.14600812 0.10177479</span>
<span class="co">#&gt; 6  0.27598530 0.27488561 0.19127215 0.19127215 0.19127215 0.19127215 0.07630430</span>
<span class="co">#&gt; 7  0.21876978 0.21867982 0.16460636 0.16460636 0.16460636 0.16460636 0.09109887</span>
<span class="co">#&gt; 8  0.27368944 0.27020078 0.22303359 0.22303359 0.22303359 0.22303359 0.15428636</span>
<span class="co">#&gt; 9  0.61897389 0.66531444 0.56298106 0.56298106 0.56298106 0.56298106 0.48699078</span>
<span class="co">#&gt; 10 0.21471430 0.20960715 0.18217319 0.18217319 0.18217319 0.18217319 0.13801026</span>
<span class="co">#&gt; 11 0.10223716 0.10177010 0.07457654 0.07457654 0.07457654 0.07457654 0.03703712</span>
<span class="co">#&gt; 12 0.25612598 0.25692792 0.21401266 0.21401266 0.21401266 0.21401266 0.15685888</span>
<span class="co">#&gt; 13 0.41106535 0.37893205 0.35787709 0.35787709 0.35787709 0.35787709 0.28569303</span>
<span class="co">#&gt; 14 0.16658868 0.16668649 0.12789649 0.12789649 0.12789649 0.12789649 0.07538566</span>
<span class="co">#&gt; 15 0.03958787 0.04012447 0.02885669 0.02885669 0.02885669 0.02885669 0.01429295</span>
<span class="co">#&gt; 16 0.12961367 0.12871903 0.09688986 0.09688986 0.09688986 0.09688986 0.05247897</span>
<span class="co">#&gt; 17 0.08317991 0.08336080 0.05723015 0.05723015 0.05723015 0.05723015 0.02201261</span>
<span class="co">#&gt; 18 0.10566284 0.10572069 0.07316008 0.07316008 0.07316008 0.07316008 0.02904920</span>
<span class="co">#&gt; 19 0.06292758 0.06309526 0.04415917 0.04415917 0.04415917 0.04415917 0.01868775</span>
<span class="co">#&gt;    2020-03-30 2020-04-01 2020-04-02 2020-04-09</span>
<span class="co">#&gt; 1  0.39449789 0.43597210 0.43597210 0.23460003</span>
<span class="co">#&gt; 2  0.01766789 0.04334024 0.04334024 0.02735465</span>
<span class="co">#&gt; 3  0.04962067 0.05885529 0.05885529 0.02664316</span>
<span class="co">#&gt; 4  0.03129136 0.03849180 0.03849180 0.01683101</span>
<span class="co">#&gt; 5  0.10177479 0.14600812 0.14600812 0.07444275</span>
<span class="co">#&gt; 6  0.07630430 0.19127215 0.19127215 0.10338539</span>
<span class="co">#&gt; 7  0.09109887 0.16460636 0.16460636 0.08347167</span>
<span class="co">#&gt; 8  0.15428636 0.22303359 0.22303359 0.09496879</span>
<span class="co">#&gt; 9  0.48699078 0.56298106 0.56298106 0.38247086</span>
<span class="co">#&gt; 10 0.13801026 0.18217319 0.18217319 0.06763743</span>
<span class="co">#&gt; 11 0.03703712 0.07457654 0.07457654 0.03760494</span>
<span class="co">#&gt; 12 0.15685888 0.21401266 0.21401266 0.10149194</span>
<span class="co">#&gt; 13 0.28569303 0.35787709 0.35787709 0.10066989</span>
<span class="co">#&gt; 14 0.07538566 0.12789649 0.12789649 0.06418849</span>
<span class="co">#&gt; 15 0.01429295 0.02885669 0.02885669 0.01674208</span>
<span class="co">#&gt; 16 0.05247897 0.09688986 0.09688986 0.04686557</span>
<span class="co">#&gt; 17 0.02201261 0.05723015 0.05723015 0.03213796</span>
<span class="co">#&gt; 18 0.02904920 0.07316008 0.07316008 0.04032354</span>
<span class="co">#&gt; 19 0.01868775 0.04415917 0.04415917 0.02444775</span></code></pre></div>
<p>Next we plot this using the map of Spain.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shapefile_ccaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html" class="external-link">readOGR</a></span><span class="op">(</span>dsn<span class="op">=</span><span class="st">"ComunidadesAutonomas_ETRS89_30N/Comunidades_Autonomas_ETRS89_30N.shp"</span><span class="op">)</span>
<span class="co">#&gt; Warning in OGRSpatialRef(dsn, layer, morphFromESRI = morphFromESRI, dumpSRS =</span>
<span class="co">#&gt; dumpSRS, : Discarded datum European_Terrestrial_Reference_System_1989 in Proj4</span>
<span class="co">#&gt; definition: +proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m</span>
<span class="co">#&gt; +no_defs</span>
<span class="co">#&gt; OGR data source with driver: ESRI Shapefile </span>
<span class="co">#&gt; Source: "C:\Users\sevva\OneDrive\Documents\repos\composits\vignettes\ComunidadesAutonomas_ETRS89_30N\Comunidades_Autonomas_ETRS89_30N.shp", layer: "Comunidades_Autonomas_ETRS89_30N"</span>
<span class="co">#&gt; with 19 features</span>
<span class="co">#&gt; It has 3 fields</span>
<span class="va">data_ccaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">shapefile_ccaa</span><span class="op">)</span>
<span class="co">#&gt; Regions defined for each Polygons</span>
<span class="va">nombres_ccaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">shapefile_ccaa</span><span class="op">$</span><span class="va">Texto</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AN"</span>, <span class="st">"AR"</span>, <span class="st">"AS"</span>, <span class="st">"PM"</span>, <span class="st">"CN"</span>, <span class="st">"CB"</span>, <span class="st">"CL"</span>, <span class="st">"CM"</span>,
         <span class="st">"CT"</span>, <span class="st">"VC"</span>, <span class="st">"EX"</span>, <span class="st">"GA"</span>, <span class="st">"MD"</span>, <span class="st">"MU"</span>, <span class="st">"NA"</span>, <span class="st">"PV"</span>,
         <span class="st">"LO"</span>, <span class="st">"CE"</span>, <span class="st">"CE"</span><span class="op">)</span>

<span class="va">nombres_ccaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">reg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">data_ccaa_mapa</span> <span class="op">&lt;-</span> <span class="va">data_ccaa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">nombres_ccaa</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>


<span class="va">df3</span> <span class="op">&lt;-</span> <span class="va">apportioned1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">reg</span>, <span class="st">"RI"</span>, <span class="st">"LO"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">reg</span>, <span class="st">"NC"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">reg</span>, <span class="st">"MC"</span>, <span class="st">"MU"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">reg</span>, names_to <span class="op">=</span> <span class="st">"date"</span>, values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span>

<span class="va">sp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">data_ccaa_mapa</span>, <span class="va">df3</span>, by<span class="op">=</span><span class="st">"reg"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reg</span> <span class="op">!=</span> <span class="st">"CN"</span><span class="op">)</span>

<span class="va">sp_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group<span class="op">=</span><span class="va">group</span>, fill<span class="op">=</span><span class="va">score</span><span class="op">)</span>,
               color<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"YlOrBr"</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">date</span>, ncol<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, 
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="composits_files/figure-html/composite5-1.png" width="768"></p>
<p>See our <a href="https://sevvandi.github.io/composits/index.html">website</a> or
our paper <span class="citation">(Kandanaarachchi et al. 2020)</span>
*** for more examples.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-composits" class="csl-entry">
Kandanaarachchi, Sevvandi, Patricia Menendez, Ruben Loaiza-Maya, and
Ursula Laa. 2020. <span>“Outliers in Compositional Time Series
Data.”</span> Working Paper. <a href="https://www.researchgate.net/publication/343712288_Outliers_in_compositional_time_series_data" class="external-link">https://www.researchgate.net/publication/343712288_Outliers_in_compositional_time_series_data</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sevvandi Kandanaarachchi, Patricia Menendez, Ursula Laa, Ruben Loaiza-Maya.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
